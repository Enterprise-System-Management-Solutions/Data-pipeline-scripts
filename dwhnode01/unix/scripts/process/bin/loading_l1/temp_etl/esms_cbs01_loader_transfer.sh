PATH=$PATH:$HOME/.local/bin:$HOME/bin

export PATH

export TMP=/tmp
export TMPDIR=$TMP

export ORACLE_HOSTNAME=dwhnode01
export ORACLE_UNQNAME=dwhdb01
export ORACLE_BASE=/data01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/19.0.0/dbhome_1
export ORA_INVENTORY=/data01/app/oraInventory
export ORACLE_SID=dwhdb01
export DATA_DIR=/data01/oradata

export PATH=/usr/sbin:/usr/local/bin:$PATH
export PATH=$ORACLE_HOME/bin:$PATH

export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib


# This function changes the status of files where errors where encountered to 34
updateOnError()
{
sqlplus  -s <<EOF
dwh_user/dwh_user_123
SET echo off
SET head off
SET feedback off
REM "WHENEVER SQLERROR EXIT SQL.SQLCODE"
UPDATE cdr_head_merge
   SET process_status=34
 WHERE file_name='$1'
   AND process_status=30
/
COMMIT
/
EXIT
EOF
}

# This function lists files (SMSC) after mediation and status is =30

get_smsc_files()
{

sqlplus  -s <<EOF
dwh_user/dwh_user_123
SET head off
SET feedback off
SET pagesize 0
SET verify off
SET linesize 400
SELECT '/data02/cbs_cdrs/transfer/dump_dir/'||','||'/data02/cbs_cdrs/transfer/dump_dir/'||file_name||','||file_name||','||file_id
  FROM cdr_head_merge
 WHERE source='transfer'-- and trunc(PROCESS_DATE) = TRUNC(SYSDATE) 
   AND process_status=30
--   and mod  (FILE_ID,3) = 1 
   and rownum < 100
/
EOF
}


createSMSCUpdate()
{
sqlplus  -s <<EOF
dwh_user/dwh_user_123
SET echo on
SET head off
SET feedback off
WHENEVER SQLERROR EXIT SQL.SQLCODE

UPDATE cdr_head_merge
   SET process_status=32
 WHERE source='transfer'
   AND file_name='$1'
/
COMMIT
/
EXIT
EOF
}

insertSMSCUpdate()
{
sqlplus  -s <<EOF
dwh_user/dwh_user_123
SET echo on
SET head off
SET feedback off
WHENEVER SQLERROR EXIT SQL.SQLCODE
INSERT INTO L1_TRANSFER_TEMP(PROCESSED_DATE, FILE_NAME, T1_TRANSFER_LOG_ID, T2_PAY_TYPE, T3_ACCT_ID, T4_CUST_ID, T5_SUB_ID, T6_PRI_IDENTITY, T7_BATCH_NO, T8_CHANNEL_ID, T9_REASON_CODE, T10_RESULT_CODE, T11_ERROR_TYPE, T12_REQUEST_ACCT_BALANCE_ID, T13_DEST_ACCT_ID, T14_DEST_ACCT_BALANCE_ID, T15_TRANSFER_TYPE, T16_TRANSFER_AMT, T17_TRANSFER_DATE, T18_TRANSFER_TRANS_ID, T19_EXT_TRANS_TYPE, T20_EXT_TRANS_ID, T21_ACCESS_METHOD, T22_DIAMETER_SESSIONID, T23_HANDLING_CHARGE, T24_REVERSAL_TRANS_ID, T25_REVERSAL_REASON_CODE, T26_REVERSAL_DATE, T27_EXT_REF_ID, T28_STATUS, T29_ENTRY_DATE, T30_REMARK, T31_OPER_ID, T32_DEPT_ID, T33_BE_ID, T34_BE_CODE, T35_REGION_ID, T36_REGION_CODE, T37_ACCT_ID, T38_ACCT_BALANCE_ID, T39_BALANCE_TYPE, T40_CUR_BALANCE, T41_CHG_BALANCE, T42_PRE_APPLY_TIME, T43_PRE_EXPIRE_TIME, T44_CUR_EXPIRE_TIME, T45_CURRENCYE_ID, T46_OPER_TYPE, T47_ACCT_ID, T48_ACCT_BALANCE_ID, T49_BALANCE_TYPE, T50_CUR_BALANCE, T51_CHG_BALANCE, T52_PRE_APPLY_TIME, T53_PRE_EXPIRE_TIME, T54_CUR_EXPIRE_TIME, T55_CURRENCYE_ID, T56_OPER_TYPE, T57_ACCT_ID, T58_ACCT_BALANCE_ID, T59_BALANCE_TYPE, T60_CUR_BALANCE, T61_CHG_BALANCE, T62_PRE_APPLY_TIME, T63_PRE_EXPIRE_TIME, T64_CUR_EXPIRE_TIME, T65_CURRENCYE_ID, T66_OPER_TYPE, T67_ACCT_ID, T68_ACCT_BALANCE_ID, T69_BALANCE_TYPE, T70_CUR_BALANCE, T71_CHG_BALANCE, T72_PRE_APPLY_TIME, T73_PRE_EXPIRE_TIME, T74_CUR_EXPIRE_TIME, T75_CURRENCYE_ID, T76_OPER_TYPE, T77_ACCT_ID, T78_ACCT_BALANCE_ID, T79_BALANCE_TYPE, T80_CUR_BALANCE, T81_CHG_BALANCE, T82_PRE_APPLY_TIME, T83_PRE_EXPIRE_TIME, T84_CUR_EXPIRE_TIME, T85_CURRENCYE_ID, T86_OPER_TYPE, T87_ACCT_ID, T88_ACCT_BALANCE_ID, T89_BALANCE_TYPE, T90_CUR_BALANCE, T91_CHG_BALANCE, T92_PRE_APPLY_TIME, T93_PRE_EXPIRE_TIME, T94_CUR_EXPIRE_TIME, T95_CURRENCYE_ID, T96_OPER_TYPE, T97_ACCT_ID, T98_ACCT_BALANCE_ID, T99_BALANCE_TYPE, T100_CUR_BALANCE, T101_CHG_BALANCE, T102_PRE_APPLY_TIME, T103_PRE_EXPIRE_TIME, T104_CUR_EXPIRE_TIME, T105_CURRENCYE_ID, T106_OPER_TYPE, T107_ACCT_ID, T108_ACCT_BALANCE_ID, T109_BALANCE_TYPE, T110_CUR_BALANCE, T111_CHG_BALANCE, T112_PRE_APPLY_TIME, T113_PRE_EXPIRE_TIME, T114_CUR_EXPIRE_TIME, T115_CURRENCYE_ID, T116_OPER_TYPE, T117_ACCT_ID, T118_ACCT_BALANCE_ID, 
T119_BALANCE_TYPE, T120_CUR_BALANCE, T121_CHG_BALANCE, T122_PRE_APPLY_TIME, T123_PRE_EXPIRE_TIME, T124_CUR_EXPIRE_TIME, T125_CURRENCYE_ID, T126_OPER_TYPE, T127_ACCT_ID, T128_ACCT_BALANCE_ID, T129_BALANCE_TYPE, T130_CUR_BALANCE, T131_CHG_BALANCE, T132_PRE_APPLY_TIME, T133_PRE_EXPIRE_TIME, T134_CUR_EXPIRE_TIME, T135_CURRENCYE_ID, T136_OPER_TYPE, T137_FU_OWN_TYPE, T138_FU_OWN_ID, T139_FREE_UNIT_ID, T140_FREE_UNIT_TYPE, T141_CUR_AMOUNT, T142_CHG_AMOUNT, T143_PRE_APPLY_TIME, T144_PRE_EXPIRE_TIME, T145_CUR_EXPIRE_TIME, T146_FU_MEASURE_ID, T147_OPER_TYPE, T148_FU_OWN_TYPE, T149_FU_OWN_ID, T150_FREE_UNIT_ID, T151_FREE_UNIT_TYPE, T152_CUR_AMOUNT, T153_CHG_AMOUNT, T154_PRE_APPLY_TIME, T155_PRE_EXPIRE_TIME, T156_CUR_EXPIRE_TIME, T157_FU_MEASURE_ID, T158_OPER_TYPE, T159_FU_OWN_TYPE, T160_FU_OWN_ID, T161_FREE_UNIT_ID, T162_FREE_UNIT_TYPE, T163_CUR_AMOUNT, T164_CHG_AMOUNT, T165_PRE_APPLY_TIME, T166_PRE_EXPIRE_TIME, T167_CUR_EXPIRE_TIME, T168_FU_MEASURE_ID, T169_OPER_TYPE, T170_FU_OWN_TYPE, T171_FU_OWN_ID, T172_FREE_UNIT_ID, T173_FREE_UNIT_TYPE, T174_CUR_AMOUNT, T175_CHG_AMOUNT, T176_PRE_APPLY_TIME, T177_PRE_EXPIRE_TIME, T178_CUR_EXPIRE_TIME, T179_FU_MEASURE_ID, T180_OPER_TYPE, T181_FU_OWN_TYPE, T182_FU_OWN_ID, T183_FREE_UNIT_ID, T184_FREE_UNIT_TYPE, T185_CUR_AMOUNT, T186_CHG_AMOUNT, T187_PRE_APPLY_TIME, T188_PRE_EXPIRE_TIME, T189_CUR_EXPIRE_TIME, T190_FU_MEASURE_ID, T191_OPER_TYPE, T192_FU_OWN_TYPE, T193_FU_OWN_ID, T194_FREE_UNIT_ID, T195_FREE_UNIT_TYPE, T196_CUR_AMOUNT, T197_CHG_AMOUNT, T198_PRE_APPLY_TIME, T199_PRE_EXPIRE_TIME, T200_CUR_EXPIRE_TIME, T201_FU_MEASURE_ID, T202_OPER_TYPE, T203_FU_OWN_TYPE, T204_FU_OWN_ID, T205_FREE_UNIT_ID, T206_FREE_UNIT_TYPE, T207_CUR_AMOUNT, T208_CHG_AMOUNT, T209_PRE_APPLY_TIME, T210_PRE_EXPIRE_TIME, T211_CUR_EXPIRE_TIME, T212_FU_MEASURE_ID, T213_OPER_TYPE, T214_FU_OWN_TYPE, T215_FU_OWN_ID, T216_FREE_UNIT_ID, T217_FREE_UNIT_TYPE, T218_CUR_AMOUNT, T219_CHG_AMOUNT, T220_PRE_APPLY_TIME, T221_PRE_EXPIRE_TIME, T222_CUR_EXPIRE_TIME, T223_FU_MEASURE_ID, T224_OPER_TYPE, T225_FU_OWN_TYPE, T226_FU_OWN_ID, T227_FREE_UNIT_ID, T228_FREE_UNIT_TYPE, T229_CUR_AMOUNT, T230_CHG_AMOUNT, T231_PRE_APPLY_TIME, T232_PRE_EXPIRE_TIME, 
T233_CUR_EXPIRE_TIME, T234_FU_MEASURE_ID, T235_OPER_TYPE, T236_FU_OWN_TYPE, T237_FU_OWN_ID, T238_FREE_UNIT_ID, T239_FREE_UNIT_TYPE, T240_CUR_AMOUNT, T241_CHG_AMOUNT, T242_PRE_APPLY_TIME, T243_PRE_EXPIRE_TIME, T244_CUR_EXPIRE_TIME, T245_FU_MEASURE_ID, T246_OPER_TYPE, T247_ACCT_ID, T248_ACCT_BALANCE_ID, T249_BALANCE_TYPE, T250_BONUS_AMOUNT, T251_CURRENT_BALANCE, T252_PRE_APPLY_TIME, T253_PRE_EXPIRE_TIME, T254_CUR_EXPIRE_TIME, T255_CURRENCY_ID, T256_OPER_TYPE, T257_ACCT_ID, T258_ACCT_BALANCE_ID, T259_BALANCE_TYPE, T260_BONUS_AMOUNT, T261_CURRENT_BALANCE, T262_PRE_APPLY_TIME, T263_PRE_EXPIRE_TIME, T264_CUR_EXPIRE_TIME, T265_CURRENCY_ID, T266_OPER_TYPE, T267_ACCT_ID, T268_ACCT_BALANCE_ID, T269_BALANCE_TYPE, T270_BONUS_AMOUNT, T271_CURRENT_BALANCE, T272_PRE_APPLY_TIME, T273_PRE_EXPIRE_TIME, T274_CUR_EXPIRE_TIME, T275_CURRENCY_ID, T276_OPER_TYPE, T277_ACCT_ID, T278_ACCT_BALANCE_ID, T279_BALANCE_TYPE, T280_BONUS_AMOUNT, T281_CURRENT_BALANCE, T282_PRE_APPLY_TIME, T283_PRE_EXPIRE_TIME, T284_CUR_EXPIRE_TIME, T285_CURRENCY_ID, T286_OPER_TYPE, T287_ACCT_ID, T288_ACCT_BALANCE_ID, T289_BALANCE_TYPE, T290_BONUS_AMOUNT, T291_CURRENT_BALANCE, T292_PRE_APPLY_TIME, T293_PRE_EXPIRE_TIME, T294_CUR_EXPIRE_TIME, T295_CURRENCY_ID, T296_OPER_TYPE, T297_ACCT_ID, T298_ACCT_BALANCE_ID, T299_BALANCE_TYPE, T300_BONUS_AMOUNT, T301_CURRENT_BALANCE, T302_PRE_APPLY_TIME, T303_PRE_EXPIRE_TIME, T304_CUR_EXPIRE_TIME, T305_CURRENCY_ID, T306_OPER_TYPE, T307_ACCT_ID, T308_ACCT_BALANCE_ID, T309_BALANCE_TYPE, T310_BONUS_AMOUNT, T311_CURRENT_BALANCE, T312_PRE_APPLY_TIME, T313_PRE_EXPIRE_TIME, T314_CUR_EXPIRE_TIME, T315_CURRENCY_ID, T316_OPER_TYPE, T317_ACCT_ID, T318_ACCT_BALANCE_ID, T319_BALANCE_TYPE, T320_BONUS_AMOUNT, T321_CURRENT_BALANCE, T322_PRE_APPLY_TIME, T323_PRE_EXPIRE_TIME, T324_CUR_EXPIRE_TIME, T325_CURRENCY_ID, T326_OPER_TYPE, T327_ACCT_ID, T328_ACCT_BALANCE_ID, T329_BALANCE_TYPE, T330_BONUS_AMOUNT, T331_CURRENT_BALANCE, T332_PRE_APPLY_TIME, T333_PRE_EXPIRE_TIME, T334_CUR_EXPIRE_TIME, T335_CURRENCY_ID, T336_OPER_TYPE, T337_ACCT_ID, T338_ACCT_BALANCE_ID, T339_BALANCE_TYPE, T340_BONUS_AMOUNT, T341_CURRENT_BALANCE, T342_PRE_APPLY_TIME, T343_PRE_EXPIRE_TIME, 
T344_CUR_EXPIRE_TIME, T345_CURRENCY_ID, T346_OPER_TYPE, T347_FU_OWN_TYPE, T348_FU_OWN_ID, T349_FREE_UNIT_TYPE, T350_FREE_UNIT_ID, T351_BONUS_AMOUNT, T352_CURRENT_AMOUNT, T353_PRE_APPLY_TIME, T354_PRE_EXPIRE_TIME, T355_CUR_EXPIRE_TIME, T356_FU_MEASURE_ID, T357_OPER_TYPE, T358_FU_OWN_TYPE, T359_FU_OWN_ID, T360_FREE_UNIT_TYPE, T361_FREE_UNIT_ID, T362_BONUS_AMOUNT, T363_CURRENT_AMOUNT, T364_PRE_APPLY_TIME, T365_PRE_EXPIRE_TIME, T366_CUR_EXPIRE_TIME, T367_FU_MEASURE_ID, T368_OPER_TYPE, T369_FU_OWN_TYPE, T370_FU_OWN_ID, T371_FREE_UNIT_TYPE, T372_FREE_UNIT_ID, T373_BONUS_AMOUNT, T374_CURRENT_AMOUNT, T375_PRE_APPLY_TIME, T376_PRE_EXPIRE_TIME, T377_CUR_EXPIRE_TIME, T378_FU_MEASURE_ID, T379_OPER_TYPE, T380_FU_OWN_TYPE, T381_FU_OWN_ID, T382_FREE_UNIT_TYPE, T383_FREE_UNIT_ID, T384_BONUS_AMOUNT, T385_CURRENT_AMOUNT, T386_PRE_APPLY_TIME, T387_PRE_EXPIRE_TIME, T388_CUR_EXPIRE_TIME, T389_FU_MEASURE_ID, T390_OPER_TYPE, T391_FU_OWN_TYPE, T392_FU_OWN_ID, T393_FREE_UNIT_TYPE, T394_FREE_UNIT_ID, T395_BONUS_AMOUNT, T396_CURRENT_AMOUNT, T397_PRE_APPLY_TIME, T398_PRE_EXPIRE_TIME, T399_CUR_EXPIRE_TIME, T400_FU_MEASURE_ID, T401_OPER_TYPE, T402_FU_OWN_TYPE, T403_FU_OWN_ID, T404_FREE_UNIT_TYPE, T405_FREE_UNIT_ID, T406_BONUS_AMOUNT, T407_CURRENT_AMOUNT, T408_PRE_APPLY_TIME, T409_PRE_EXPIRE_TIME, T410_CUR_EXPIRE_TIME, T411_FU_MEASURE_ID, T412_OPER_TYPE, T413_FU_OWN_TYPE, T414_FU_OWN_ID, T415_FREE_UNIT_TYPE, T416_FREE_UNIT_ID, T417_BONUS_AMOUNT, T418_CURRENT_AMOUNT, T419_PRE_APPLY_TIME, T420_PRE_EXPIRE_TIME, T421_CUR_EXPIRE_TIME, T422_FU_MEASURE_ID, T423_OPER_TYPE, T424_FU_OWN_TYPE, T425_FU_OWN_ID, T426_FREE_UNIT_TYPE, T427_FREE_UNIT_ID, T428_BONUS_AMOUNT, T429_CURRENT_AMOUNT, T430_PRE_APPLY_TIME, T431_PRE_EXPIRE_TIME, T432_CUR_EXPIRE_TIME, T433_FU_MEASURE_ID, T434_OPER_TYPE, T435_FU_OWN_TYPE, T436_FU_OWN_ID, T437_FREE_UNIT_TYPE, T438_FREE_UNIT_ID, T439_BONUS_AMOUNT, T440_CURRENT_AMOUNT, T441_PRE_APPLY_TIME, T442_PRE_EXPIRE_TIME, T443_CUR_EXPIRE_TIME, T444_FU_MEASURE_ID, T445_OPER_TYPE, T446_FU_OWN_TYPE, T447_FU_OWN_ID, T448_FREE_UNIT_TYPE, T449_FREE_UNIT_ID, T450_BONUS_AMOUNT, T451_CURRENT_AMOUNT, T452_PRE_APPLY_TIME, T453_PRE_EXPIRE_TIME, 
T454_CUR_EXPIRE_TIME, T455_FU_MEASURE_ID, T456_OPER_TYPE, T457_BRANDID, T458_MAINOFFERINGID, T459_PAYTYPE, T460_STARTTIMEOFBILLCYCLE, T461_DETAIL_FEE, T462_ACCOUNT, T463_MAINBALANCEINFO, T464_CHGBALANCEINFO, T465_CHGFREEUNITINFO, T466_USERSTATE, T467_OLDUSERSTATE, T468_TRANSFERTYPE, T469_DEST_PRI_IDENTITY, T470_SPID, T471_ADDITIONALINFO, T472_MERCHANT, T473_SERVICE, T474_LOAN_TRANS_ID, T475_ACCOUNT_KEY, T476_OWNER_CUST_CODE, T477_OTHERNUMBER, T478_BILL_CYCLE_ID, T479_VALIDDAYADDED, T480_PREPAID_BALANCE, T481_POSTPAID_BALANCE, T482_OLD_S2_EXP_DATE, T483_CUR_S2_EXP_DATE, T484_OLD_S3_EXP_DATE, T485_CUR_S3_EXP_DATE, T486_OLD_S4_EXP_DATE, T487_CUR_S4_EXP_DATE, T488_STANDARDEVENTID, T489_CHARGE_OF_FUND, T490_DEBIT_FROM_PREPAID, T491_DEBIT_FROM_POSTPAID, T492_SUBSCRIBER_KEY, T493_LOAN_AMOUNT, T494_LOAN_POUNDATE, T495_LOAN_PENALTY, T496_OPERATIONTYPE)
(SELECT TO_DATE(TO_CHAR(sysdate, 'MM/DD/YYYY'), 'MM/DD/YYYY'), FILE_NAME, T1_TRANSFER_LOG_ID, T2_PAY_TYPE, T3_ACCT_ID, T4_CUST_ID, T5_SUB_ID, T6_PRI_IDENTITY, T7_BATCH_NO, T8_CHANNEL_ID, T9_REASON_CODE, T10_RESULT_CODE, T11_ERROR_TYPE, T12_REQUEST_ACCT_BALANCE_ID, T13_DEST_ACCT_ID, T14_DEST_ACCT_BALANCE_ID, T15_TRANSFER_TYPE, T16_TRANSFER_AMT, T17_TRANSFER_DATE, T18_TRANSFER_TRANS_ID, T19_EXT_TRANS_TYPE, T20_EXT_TRANS_ID, T21_ACCESS_METHOD, T22_DIAMETER_SESSIONID, T23_HANDLING_CHARGE, T24_REVERSAL_TRANS_ID, T25_REVERSAL_REASON_CODE, T26_REVERSAL_DATE, T27_EXT_REF_ID, T28_STATUS, T29_ENTRY_DATE, T30_REMARK, T31_OPER_ID, T32_DEPT_ID, T33_BE_ID, T34_BE_CODE, T35_REGION_ID, T36_REGION_CODE, T37_ACCT_ID, T38_ACCT_BALANCE_ID, T39_BALANCE_TYPE, T40_CUR_BALANCE, T41_CHG_BALANCE, T42_PRE_APPLY_TIME, T43_PRE_EXPIRE_TIME, T44_CUR_EXPIRE_TIME, T45_CURRENCYE_ID, T46_OPER_TYPE, T47_ACCT_ID, T48_ACCT_BALANCE_ID, T49_BALANCE_TYPE, T50_CUR_BALANCE, T51_CHG_BALANCE, T52_PRE_APPLY_TIME, T53_PRE_EXPIRE_TIME, T54_CUR_EXPIRE_TIME, T55_CURRENCYE_ID, T56_OPER_TYPE, T57_ACCT_ID, T58_ACCT_BALANCE_ID, T59_BALANCE_TYPE, T60_CUR_BALANCE, T61_CHG_BALANCE, T62_PRE_APPLY_TIME, T63_PRE_EXPIRE_TIME, T64_CUR_EXPIRE_TIME, T65_CURRENCYE_ID, T66_OPER_TYPE, T67_ACCT_ID, T68_ACCT_BALANCE_ID, T69_BALANCE_TYPE, T70_CUR_BALANCE, T71_CHG_BALANCE, T72_PRE_APPLY_TIME, T73_PRE_EXPIRE_TIME, T74_CUR_EXPIRE_TIME, T75_CURRENCYE_ID, T76_OPER_TYPE, T77_ACCT_ID, T78_ACCT_BALANCE_ID, T79_BALANCE_TYPE, T80_CUR_BALANCE, T81_CHG_BALANCE, T82_PRE_APPLY_TIME, T83_PRE_EXPIRE_TIME, T84_CUR_EXPIRE_TIME, T85_CURRENCYE_ID, T86_OPER_TYPE, T87_ACCT_ID, T88_ACCT_BALANCE_ID, T89_BALANCE_TYPE, T90_CUR_BALANCE, T91_CHG_BALANCE, T92_PRE_APPLY_TIME, T93_PRE_EXPIRE_TIME, T94_CUR_EXPIRE_TIME, T95_CURRENCYE_ID, T96_OPER_TYPE, T97_ACCT_ID, T98_ACCT_BALANCE_ID, T99_BALANCE_TYPE, T100_CUR_BALANCE, T101_CHG_BALANCE, T102_PRE_APPLY_TIME, T103_PRE_EXPIRE_TIME, T104_CUR_EXPIRE_TIME, T105_CURRENCYE_ID, T106_OPER_TYPE, T107_ACCT_ID, T108_ACCT_BALANCE_ID, T109_BALANCE_TYPE, T110_CUR_BALANCE, T111_CHG_BALANCE, T112_PRE_APPLY_TIME, T113_PRE_EXPIRE_TIME, T114_CUR_EXPIRE_TIME, T115_CURRENCYE_ID, T116_OPER_TYPE, T117_ACCT_ID, T118_ACCT_BALANCE_ID, 
T119_BALANCE_TYPE, T120_CUR_BALANCE, T121_CHG_BALANCE, T122_PRE_APPLY_TIME, T123_PRE_EXPIRE_TIME, T124_CUR_EXPIRE_TIME, T125_CURRENCYE_ID, T126_OPER_TYPE, T127_ACCT_ID, T128_ACCT_BALANCE_ID, T129_BALANCE_TYPE, T130_CUR_BALANCE, T131_CHG_BALANCE, T132_PRE_APPLY_TIME, T133_PRE_EXPIRE_TIME, T134_CUR_EXPIRE_TIME, T135_CURRENCYE_ID, T136_OPER_TYPE, T137_FU_OWN_TYPE, T138_FU_OWN_ID, T139_FREE_UNIT_ID, T140_FREE_UNIT_TYPE, T141_CUR_AMOUNT, T142_CHG_AMOUNT, T143_PRE_APPLY_TIME, T144_PRE_EXPIRE_TIME, T145_CUR_EXPIRE_TIME, T146_FU_MEASURE_ID, T147_OPER_TYPE, T148_FU_OWN_TYPE, T149_FU_OWN_ID, T150_FREE_UNIT_ID, T151_FREE_UNIT_TYPE, T152_CUR_AMOUNT, T153_CHG_AMOUNT, T154_PRE_APPLY_TIME, T155_PRE_EXPIRE_TIME, T156_CUR_EXPIRE_TIME, T157_FU_MEASURE_ID, T158_OPER_TYPE, T159_FU_OWN_TYPE, T160_FU_OWN_ID, T161_FREE_UNIT_ID, T162_FREE_UNIT_TYPE, T163_CUR_AMOUNT, T164_CHG_AMOUNT, T165_PRE_APPLY_TIME, T166_PRE_EXPIRE_TIME, T167_CUR_EXPIRE_TIME, T168_FU_MEASURE_ID, T169_OPER_TYPE, T170_FU_OWN_TYPE, T171_FU_OWN_ID, T172_FREE_UNIT_ID, T173_FREE_UNIT_TYPE, T174_CUR_AMOUNT, T175_CHG_AMOUNT, T176_PRE_APPLY_TIME, T177_PRE_EXPIRE_TIME, T178_CUR_EXPIRE_TIME, T179_FU_MEASURE_ID, T180_OPER_TYPE, T181_FU_OWN_TYPE, T182_FU_OWN_ID, T183_FREE_UNIT_ID, T184_FREE_UNIT_TYPE, T185_CUR_AMOUNT, T186_CHG_AMOUNT, T187_PRE_APPLY_TIME, T188_PRE_EXPIRE_TIME, T189_CUR_EXPIRE_TIME, T190_FU_MEASURE_ID, T191_OPER_TYPE, T192_FU_OWN_TYPE, T193_FU_OWN_ID, T194_FREE_UNIT_ID, T195_FREE_UNIT_TYPE, T196_CUR_AMOUNT, T197_CHG_AMOUNT, T198_PRE_APPLY_TIME, T199_PRE_EXPIRE_TIME, T200_CUR_EXPIRE_TIME, T201_FU_MEASURE_ID, T202_OPER_TYPE, T203_FU_OWN_TYPE, T204_FU_OWN_ID, T205_FREE_UNIT_ID, T206_FREE_UNIT_TYPE, T207_CUR_AMOUNT, T208_CHG_AMOUNT, T209_PRE_APPLY_TIME, T210_PRE_EXPIRE_TIME, T211_CUR_EXPIRE_TIME, T212_FU_MEASURE_ID, T213_OPER_TYPE, T214_FU_OWN_TYPE, T215_FU_OWN_ID, T216_FREE_UNIT_ID, T217_FREE_UNIT_TYPE, T218_CUR_AMOUNT, T219_CHG_AMOUNT, T220_PRE_APPLY_TIME, T221_PRE_EXPIRE_TIME, T222_CUR_EXPIRE_TIME, T223_FU_MEASURE_ID, T224_OPER_TYPE, T225_FU_OWN_TYPE, T226_FU_OWN_ID, T227_FREE_UNIT_ID, T228_FREE_UNIT_TYPE, T229_CUR_AMOUNT, T230_CHG_AMOUNT, T231_PRE_APPLY_TIME, T232_PRE_EXPIRE_TIME, 
T233_CUR_EXPIRE_TIME, T234_FU_MEASURE_ID, T235_OPER_TYPE, T236_FU_OWN_TYPE, T237_FU_OWN_ID, T238_FREE_UNIT_ID, T239_FREE_UNIT_TYPE, T240_CUR_AMOUNT, T241_CHG_AMOUNT, T242_PRE_APPLY_TIME, T243_PRE_EXPIRE_TIME, T244_CUR_EXPIRE_TIME, T245_FU_MEASURE_ID, T246_OPER_TYPE, T247_ACCT_ID, T248_ACCT_BALANCE_ID, T249_BALANCE_TYPE, T250_BONUS_AMOUNT, T251_CURRENT_BALANCE, T252_PRE_APPLY_TIME, T253_PRE_EXPIRE_TIME, T254_CUR_EXPIRE_TIME, T255_CURRENCY_ID, T256_OPER_TYPE, T257_ACCT_ID, T258_ACCT_BALANCE_ID, T259_BALANCE_TYPE, T260_BONUS_AMOUNT, T261_CURRENT_BALANCE, T262_PRE_APPLY_TIME, T263_PRE_EXPIRE_TIME, T264_CUR_EXPIRE_TIME, T265_CURRENCY_ID, T266_OPER_TYPE, T267_ACCT_ID, T268_ACCT_BALANCE_ID, T269_BALANCE_TYPE, T270_BONUS_AMOUNT, T271_CURRENT_BALANCE, T272_PRE_APPLY_TIME, T273_PRE_EXPIRE_TIME, T274_CUR_EXPIRE_TIME, T275_CURRENCY_ID, T276_OPER_TYPE, T277_ACCT_ID, T278_ACCT_BALANCE_ID, T279_BALANCE_TYPE, T280_BONUS_AMOUNT, T281_CURRENT_BALANCE, T282_PRE_APPLY_TIME, T283_PRE_EXPIRE_TIME, T284_CUR_EXPIRE_TIME, T285_CURRENCY_ID, T286_OPER_TYPE, T287_ACCT_ID, T288_ACCT_BALANCE_ID, T289_BALANCE_TYPE, T290_BONUS_AMOUNT, T291_CURRENT_BALANCE, T292_PRE_APPLY_TIME, T293_PRE_EXPIRE_TIME, T294_CUR_EXPIRE_TIME, T295_CURRENCY_ID, T296_OPER_TYPE, T297_ACCT_ID, T298_ACCT_BALANCE_ID, T299_BALANCE_TYPE, T300_BONUS_AMOUNT, T301_CURRENT_BALANCE, T302_PRE_APPLY_TIME, T303_PRE_EXPIRE_TIME, T304_CUR_EXPIRE_TIME, T305_CURRENCY_ID, T306_OPER_TYPE, T307_ACCT_ID, T308_ACCT_BALANCE_ID, T309_BALANCE_TYPE, T310_BONUS_AMOUNT, T311_CURRENT_BALANCE, T312_PRE_APPLY_TIME, T313_PRE_EXPIRE_TIME, T314_CUR_EXPIRE_TIME, T315_CURRENCY_ID, T316_OPER_TYPE, T317_ACCT_ID, T318_ACCT_BALANCE_ID, T319_BALANCE_TYPE, T320_BONUS_AMOUNT, T321_CURRENT_BALANCE, T322_PRE_APPLY_TIME, T323_PRE_EXPIRE_TIME, T324_CUR_EXPIRE_TIME, T325_CURRENCY_ID, T326_OPER_TYPE, T327_ACCT_ID, T328_ACCT_BALANCE_ID, T329_BALANCE_TYPE, T330_BONUS_AMOUNT, T331_CURRENT_BALANCE, T332_PRE_APPLY_TIME, T333_PRE_EXPIRE_TIME, T334_CUR_EXPIRE_TIME, T335_CURRENCY_ID, T336_OPER_TYPE, T337_ACCT_ID, T338_ACCT_BALANCE_ID, T339_BALANCE_TYPE, T340_BONUS_AMOUNT, T341_CURRENT_BALANCE, T342_PRE_APPLY_TIME, T343_PRE_EXPIRE_TIME, 
T344_CUR_EXPIRE_TIME, T345_CURRENCY_ID, T346_OPER_TYPE, T347_FU_OWN_TYPE, T348_FU_OWN_ID, T349_FREE_UNIT_TYPE, T350_FREE_UNIT_ID, T351_BONUS_AMOUNT, T352_CURRENT_AMOUNT, T353_PRE_APPLY_TIME, T354_PRE_EXPIRE_TIME, T355_CUR_EXPIRE_TIME, T356_FU_MEASURE_ID, T357_OPER_TYPE, T358_FU_OWN_TYPE, T359_FU_OWN_ID, T360_FREE_UNIT_TYPE, T361_FREE_UNIT_ID, T362_BONUS_AMOUNT, T363_CURRENT_AMOUNT, T364_PRE_APPLY_TIME, T365_PRE_EXPIRE_TIME, T366_CUR_EXPIRE_TIME, T367_FU_MEASURE_ID, T368_OPER_TYPE, T369_FU_OWN_TYPE, T370_FU_OWN_ID, T371_FREE_UNIT_TYPE, T372_FREE_UNIT_ID, T373_BONUS_AMOUNT, T374_CURRENT_AMOUNT, T375_PRE_APPLY_TIME, T376_PRE_EXPIRE_TIME, T377_CUR_EXPIRE_TIME, T378_FU_MEASURE_ID, T379_OPER_TYPE, T380_FU_OWN_TYPE, T381_FU_OWN_ID, T382_FREE_UNIT_TYPE, T383_FREE_UNIT_ID, T384_BONUS_AMOUNT, T385_CURRENT_AMOUNT, T386_PRE_APPLY_TIME, T387_PRE_EXPIRE_TIME, T388_CUR_EXPIRE_TIME, T389_FU_MEASURE_ID, T390_OPER_TYPE, T391_FU_OWN_TYPE, T392_FU_OWN_ID, T393_FREE_UNIT_TYPE, T394_FREE_UNIT_ID, T395_BONUS_AMOUNT, T396_CURRENT_AMOUNT, T397_PRE_APPLY_TIME, T398_PRE_EXPIRE_TIME, T399_CUR_EXPIRE_TIME, T400_FU_MEASURE_ID, T401_OPER_TYPE, T402_FU_OWN_TYPE, T403_FU_OWN_ID, T404_FREE_UNIT_TYPE, T405_FREE_UNIT_ID, T406_BONUS_AMOUNT, T407_CURRENT_AMOUNT, T408_PRE_APPLY_TIME, T409_PRE_EXPIRE_TIME, T410_CUR_EXPIRE_TIME, T411_FU_MEASURE_ID, T412_OPER_TYPE, T413_FU_OWN_TYPE, T414_FU_OWN_ID, T415_FREE_UNIT_TYPE, T416_FREE_UNIT_ID, T417_BONUS_AMOUNT, T418_CURRENT_AMOUNT, T419_PRE_APPLY_TIME, T420_PRE_EXPIRE_TIME, T421_CUR_EXPIRE_TIME, T422_FU_MEASURE_ID, T423_OPER_TYPE, T424_FU_OWN_TYPE, T425_FU_OWN_ID, T426_FREE_UNIT_TYPE, T427_FREE_UNIT_ID, T428_BONUS_AMOUNT, T429_CURRENT_AMOUNT, T430_PRE_APPLY_TIME, T431_PRE_EXPIRE_TIME, T432_CUR_EXPIRE_TIME, T433_FU_MEASURE_ID, T434_OPER_TYPE, T435_FU_OWN_TYPE, T436_FU_OWN_ID, T437_FREE_UNIT_TYPE, T438_FREE_UNIT_ID, T439_BONUS_AMOUNT, T440_CURRENT_AMOUNT, T441_PRE_APPLY_TIME, T442_PRE_EXPIRE_TIME, T443_CUR_EXPIRE_TIME, T444_FU_MEASURE_ID, T445_OPER_TYPE, T446_FU_OWN_TYPE, T447_FU_OWN_ID, T448_FREE_UNIT_TYPE, T449_FREE_UNIT_ID, T450_BONUS_AMOUNT, T451_CURRENT_AMOUNT, T452_PRE_APPLY_TIME, T453_PRE_EXPIRE_TIME, 
T454_CUR_EXPIRE_TIME, T455_FU_MEASURE_ID, T456_OPER_TYPE, T457_BRANDID, T458_MAINOFFERINGID, T459_PAYTYPE, T460_STARTTIMEOFBILLCYCLE, T461_DETAIL_FEE, T462_ACCOUNT, T463_MAINBALANCEINFO, T464_CHGBALANCEINFO, T465_CHGFREEUNITINFO, T466_USERSTATE, T467_OLDUSERSTATE, T468_TRANSFERTYPE, T469_DEST_PRI_IDENTITY, T470_SPID, T471_ADDITIONALINFO, T472_MERCHANT, T473_SERVICE, T474_LOAN_TRANS_ID, T475_ACCOUNT_KEY, T476_OWNER_CUST_CODE, T477_OTHERNUMBER, T478_BILL_CYCLE_ID, T479_VALIDDAYADDED, T480_PREPAID_BALANCE, T481_POSTPAID_BALANCE, T482_OLD_S2_EXP_DATE, T483_CUR_S2_EXP_DATE, T484_OLD_S3_EXP_DATE, T485_CUR_S3_EXP_DATE, T486_OLD_S4_EXP_DATE, T487_CUR_S4_EXP_DATE, T488_STANDARDEVENTID, T489_CHARGE_OF_FUND, T490_DEBIT_FROM_PREPAID, T491_DEBIT_FROM_POSTPAID, T492_SUBSCRIBER_KEY, T493_LOAN_AMOUNT, T494_LOAN_POUNDATE, T495_LOAN_PENALTY, T496_OPERATIONTYPE FROM TRANSFER01_EXT)

/
COMMIT
/
UPDATE cdr_head_merge
   SET process_status=96
 WHERE source='transfer'
   AND file_name='$1'
/
COMMIT
/
EXIT
EOF
}

# ======= SMSC SECTION =====

lock=/data02/scripts/process/bin/l1_transfer_temp_loader_lock  export lock

if [ -f $lock ] ; then
exit 2

else
touch $lock

fileList=`get_smsc_files`

for fil in $fileList
do

v3=`echo ${fil}|sed s/,/\ /g|awk '{print $3}'`   ### file name
v4=`echo ${fil}|sed s/,/\ /g|awk '{print $4}'`   ### file id

cd /data02/scripts/process/bin/loading_l1/temp_etl/
sh esms_create_cbs01_ext_transfer.sh $v3 
createSMSCUpdate $v3
insertSMSCUpdate $v3


# ~~~~~~~~~~~~~~~~~~~~~~~~
updateOnError $v3 $v4
#~~~~~~~~~~~~~~~~~~~~~~~~~

done

rm -f $lock

fi


