PATH=$PATH:$HOME/.local/bin:$HOME/bin

export PATH

export TMP=/tmp
export TMPDIR=$TMP

export ORACLE_HOSTNAME=dwhnode01
export ORACLE_UNQNAME=dwhdb01
export ORACLE_BASE=/data01/app/oracle
export ORACLE_HOME=$ORACLE_BASE/product/19.0.0/dbhome_1
export ORA_INVENTORY=/data01/app/oraInventory
export ORACLE_SID=dwhdb01
export DATA_DIR=/data01/oradata

export PATH=/usr/sbin:/usr/local/bin:$PATH
export PATH=$ORACLE_HOME/bin:$PATH

export LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib
export CLASSPATH=$ORACLE_HOME/jlib:$ORACLE_HOME/rdbms/jlib

# This function changes the status of files where errors where encountered to 34
updateOnError()
{
sqlplus  -s <<EOF
dwh_user/dwh_user_123
SET echo off
SET head off
SET feedback off
REM "WHENEVER SQLERROR EXIT SQL.SQLCODE"
UPDATE cdr_head_merge
   SET process_status=34
 WHERE file_name='$1'
   AND process_status=30
/
COMMIT
/
EXIT
EOF
}

# This function lists files (SMSC) after mediation and status is =30

get_smsc_files()
{

sqlplus  -s <<EOF
dwh_user/dwh_user_123
SET head off
SET feedback off
SET pagesize 0
SET verify off
SET linesize 400
SELECT '/data02/cbs_cdrs/sms/dump_dir/'||','||'/data02/cbs_cdrs/sms/dump_dir/'||file_name||','||file_name||','||file_id
  FROM cdr_head_merge
 WHERE source='sms'-- and trunc(PROCESS_DATE) = TRUNC(SYSDATE) 
   AND process_status=30
--   and mod  (FILE_ID,3) = 1 
   and rownum < 100
/
EOF
}


createSMSCUpdate()
{
sqlplus  -s <<EOF
dwh_user/dwh_user_123
SET echo on
SET head off
SET feedback off
WHENEVER SQLERROR EXIT SQL.SQLCODE

UPDATE cdr_head_merge
   SET process_status=32
 WHERE source='sms'
   AND file_name='$1'
/
COMMIT
/
EXIT
EOF
}

insertSMSCUpdate()
{
sqlplus  -s <<EOF
dwh_user/dwh_user_123
SET echo on
SET head off
SET feedback off
WHENEVER SQLERROR EXIT SQL.SQLCODE

INSERT INTO L1_SMS_temp( PROCESSED_DATE, FILE_NAME, S1_CDR_ID, S2_CDR_SUB_ID, S3_CDR_TYPE, S4_SPLIT_CDR_REASON, S5_CDR_BATCH_ID, S6_SRC_REC_LINE_NO, S7_SRC_CDR_ID, S8_SRC_CDR_NO, S9_STATUS, S10_RE_RATING_TIMES, S11_CREATE_DATE, S12_START_DATE, S13_END_DATE, S14_CUST_LOCAL_START_DATE, S15_CUST_LOCAL_END_DATE, S16_STD_EVT_TYPE_ID, S17_EVT_SOURCE_CATEGORY, S18_OBJ_TYPE, S19_OBJ_ID, S20_OWNER_CUST_ID, S21_DEFAULT_ACCT_ID, S22_PRI_IDENTITY, S23_BILL_CYCLE_ID, S24_SERVICE_CATEGORY, S25_USAGE_SERVICE_TYPE, S26_SESSION_ID, S27_RESULT_CODE, S28_RESULT_REASON, S29_BE_ID, S30_HOT_SEQ, S31_CP_ID, S32_RECIPIENT_NUMBER, S33_USAGE_MEASURE_ID, S34_ACTUAL_USAGE, S35_RATE_USAGE, S36_SERVICE_UNIT_TYPE, S37_USAGE_MEASURE_ID2, S38_ACTUAL_USAGE2, S39_RATE_USAGE2, S40_SERVICE_UNIT_TYPE2, S41_DEBIT_AMOUNT, S42_RESERVED, S43_DEBIT_FROM_PREPAID, S44_DEBIT_FROM_ADVANCE_PREPAID, S45_DEBIT_FROM_POSTPAID, S46_DEBIT_FROM_ADVANCE_POST, S47_DEBIT_FROM_CREDIT_POSTPAID, S48_TOTAL_TAX, S49_PAY_FREE_UNIT_TIMES, S50_PAY_FREE_UNIT_DURATION, 
S51_FREE_UNIT_AMOUNT_OF_FLUX, S52_ACCT_ID, S53_ACCT_BALANCE_ID, S54_BALANCE_TYPE, S55_CUR_BALANCE, S56_CHG_BALANCE, S57_CURRENCY_ID, S58_OPER_TYPE, S59_ACCT_ID, S60_ACCT_BALANCE_ID, S61_BALANCE_TYPE, S62_CUR_BALANCE, S63_CHG_BALANCE, S64_CURRENCY_ID, S65_OPER_TYPE, S66_ACCT_ID, S67_ACCT_BALANCE_ID, S68_BALANCE_TYPE, S69_CUR_BALANCE, S70_CHG_BALANCE, S71_CURRENCY_ID, S72_OPER_TYPE, S73_ACCT_ID, S74_ACCT_BALANCE_ID, S75_BALANCE_TYPE, S76_CUR_BALANCE, S77_CHG_BALANCE, S78_CURRENCY_ID, S79_OPER_TYPE, S80_ACCT_ID, S81_ACCT_BALANCE_ID, S82_BALANCE_TYPE, S83_CUR_BALANCE, S84_CHG_BALANCE, S85_CURRENCY_ID, S86_OPER_TYPE, S87_ACCT_ID, S88_ACCT_BALANCE_ID, S89_BALANCE_TYPE, S90_CUR_BALANCE, S91_CHG_BALANCE, S92_CURRENCY_ID, S93_OPER_TYPE, S94_ACCT_ID, S95_ACCT_BALANCE_ID, S96_BALANCE_TYPE, S97_CUR_BALANCE, S98_CHG_BALANCE, S99_CURRENCY_ID, S100_OPER_TYPE, S101_ACCT_ID, S102_ACCT_BALANCE_ID, S103_BALANCE_TYPE, S104_CUR_BALANCE, S105_CHG_BALANCE, S106_CURRENCY_ID, S107_OPER_TYPE, S108_ACCT_ID, S109_ACCT_BALANCE_ID, 
S110_BALANCE_TYPE, S111_CUR_BALANCE, S112_CHG_BALANCE, S113_CURRENCY_ID, S114_OPER_TYPE, S115_ACCT_ID, S116_ACCT_BALANCE_ID, S117_BALANCE_TYPE, S118_CUR_BALANCE, S119_CHG_BALANCE, S120_CURRENCY_ID, S121_OPER_TYPE, S122_FU_OWN_TYPE, S123_FU_OWN_ID, S124_FREE_UNIT_ID, S125_FREE_UNIT_TYPE, S126_CUR_AMOUNT, S127_CHG_AMOUNT, S128_FU_MEASURE_ID, S129_OPER_TYPE, S130_FU_OWN_TYPE, S131_FU_OWN_ID, S132_FREE_UNIT_ID, S133_FREE_UNIT_TYPE, S134_CUR_AMOUNT, S135_CHG_AMOUNT, S136_FU_MEASURE_ID, S137_OPER_TYPE, S138_FU_OWN_TYPE, S139_FU_OWN_ID, S140_FREE_UNIT_ID, S141_FREE_UNIT_TYPE, S142_CUR_AMOUNT, S143_CHG_AMOUNT, S144_FU_MEASURE_ID, S145_OPER_TYPE, S146_FU_OWN_TYPE, S147_FU_OWN_ID, S148_FREE_UNIT_ID, S149_FREE_UNIT_TYPE, S150_CUR_AMOUNT, S151_CHG_AMOUNT, S152_FU_MEASURE_ID, S153_OPER_TYPE, S154_FU_OWN_TYPE, S155_FU_OWN_ID, S156_FREE_UNIT_ID, S157_FREE_UNIT_TYPE, S158_CUR_AMOUNT, S159_CHG_AMOUNT, S160_FU_MEASURE_ID, S161_OPER_TYPE, S162_FU_OWN_TYPE, S163_FU_OWN_ID, S164_FREE_UNIT_ID, S165_FREE_UNIT_TYPE, S166_CUR_AMOUNT, 
S167_CHG_AMOUNT, S168_FU_MEASURE_ID, S169_OPER_TYPE, S170_FU_OWN_TYPE, S171_FU_OWN_ID, S172_FREE_UNIT_ID, S173_FREE_UNIT_TYPE, S174_CUR_AMOUNT, S175_CHG_AMOUNT, S176_FU_MEASURE_ID, S177_OPER_TYPE, S178_FU_OWN_TYPE, S179_FU_OWN_ID, S180_FREE_UNIT_ID, S181_FREE_UNIT_TYPE, S182_CUR_AMOUNT, S183_CHG_AMOUNT, S184_FU_MEASURE_ID, S185_OPER_TYPE, S186_FU_OWN_TYPE, S187_FU_OWN_ID, S188_FREE_UNIT_ID, S189_FREE_UNIT_TYPE, S190_CUR_AMOUNT, S191_CHG_AMOUNT, S192_FU_MEASURE_ID, S193_OPER_TYPE, S194_FU_OWN_TYPE, S195_FU_OWN_ID, S196_FREE_UNIT_ID, S197_FREE_UNIT_TYPE, S198_CUR_AMOUNT, S199_CHG_AMOUNT, S200_FU_MEASURE_ID, S201_OPER_TYPE, S202_ACCT_ID, S203_ACCT_BALANCE_ID, S204_BALANCE_TYPE, S205_BONUS_AMOUNT, S206_CUR_BALANCE, S207_CURRENCY_ID, S208_OPER_TYPE, S209_CUR_EXPIRE_TIME, S210_ACCT_ID, S211_ACCT_BALANCE_ID, S212_BALANCE_TYPE, S213_CUR_BALANCE, S214_CHG_BALANCE, S215_CURRENCY_ID, S216_OPER_TYPE, S217_CUR_EXPIRE_TIME, S218_ACCT_ID, S219_ACCT_BALANCE_ID, S220_BALANCE_TYPE, S221_CUR_BALANCE, S222_CHG_BALANCE, S223_CURRENCY_ID, 
S224_OPER_TYPE, S225_CUR_EXPIRE_TIME, S226_ACCT_ID, S227_ACCT_BALANCE_ID, S228_BALANCE_TYPE, S229_BONUS_AMOUNT, S230_CUR_BALANCE, S231_CURRENCY_ID, S232_OPER_TYPE, S233_CUR_EXPIRE_TIME, S234_ACCT_ID, S235_ACCT_BALANCE_ID, S236_BALANCE_TYPE, S237_BONUS_AMOUNT, S238_CUR_BALANCE, S239_CURRENCY_ID, S240_OPER_TYPE, S241_CUR_EXPIRE_TIME, S242_ACCT_ID, S243_ACCT_BALANCE_ID, S244_BALANCE_TYPE, S245_BONUS_AMOUNT, S246_CUR_BALANCE, S247_CURRENCY_ID, S248_OPER_TYPE, S249_CUR_EXPIRE_TIME, S250_ACCT_ID, S251_ACCT_BALANCE_ID, S252_BALANCE_TYPE, S253_BONUS_AMOUNT, S254_CUR_BALANCE, S255_CURRENCY_ID, S256_OPER_TYPE, S257_CUR_EXPIRE_TIME, S258_ACCT_ID, S259_ACCT_BALANCE_ID, S260_BALANCE_TYPE, S261_BONUS_AMOUNT, S262_CUR_BALANCE, S263_CURRENCY_ID, S264_OPER_TYPE, S265_CUR_EXPIRE_TIME, S266_ACCT_ID, S267_ACCT_BALANCE_ID, S268_BALANCE_TYPE, S269_BONUS_AMOUNT, S270_CUR_BALANCE, S271_CURRENCY_ID, S272_OPER_TYPE, S273_CUR_EXPIRE_TIME, S274_ACCT_ID, S275_ACCT_BALANCE_ID, S276_BALANCE_TYPE, S277_BONUS_AMOUNT, S278_CUR_BALANCE, S279_CURRENCY_ID, 
S280_OPER_TYPE, S281_CUR_EXPIRE_TIME, S282_FU_OWN_TYPE, S283_FU_OWN_ID, S284_FREE_UNIT_TYPE, S285_FREE_UNIT_ID, S286_BONUS_AMOUNT, S287_CURRENT_AMOUNT, S288_FU_MEASURE_ID, S289_OPER_TYPE, S290_CUR_EXPIRE_TIME, S291_FU_OWN_TYPE, S292_FU_OWN_ID, S293_FREE_UNIT_TYPE, S294_FREE_UNIT_ID, S295_BONUS_AMOUNT, S296_CURRENT_AMOUNT, S297_FU_MEASURE_ID, S298_OPER_TYPE, S299_CUR_EXPIRE_TIME, S300_FU_OWN_TYPE, S301_FU_OWN_ID, S302_FREE_UNIT_TYPE, S303_FREE_UNIT_ID, S304_BONUS_AMOUNT, S305_CURRENT_AMOUNT, S306_FU_MEASURE_ID, S307_OPER_TYPE, S308_CUR_EXPIRE_TIME, S309_FU_OWN_TYPE, S310_FU_OWN_ID, S311_FREE_UNIT_TYPE, S312_FREE_UNIT_ID, S313_BONUS_AMOUNT, S314_CURRENT_AMOUNT, S315_FU_MEASURE_ID, S316_OPER_TYPE, S317_CURRENT_AMOUNT, S318_FU_OWN_TYPE, S319_FU_OWN_ID, S320_FREE_UNIT_TYPE, S321_FREE_UNIT_ID, S322_BONUS_AMOUNT, S323_CURRENT_AMOUNT, S324_FU_MEASURE_ID, S325_OPER_TYPE, S326_CUR_EXPIRE_TIME, S327_FU_OWN_TYPE, S328_FU_OWN_ID, S329_FREE_UNIT_TYPE, S330_FREE_UNIT_ID, S331_BONUS_AMOUNT, S332_CURRENT_AMOUNT, S333_FU_MEASURE_ID, S334_OPER_TYPE, 
S335_CUR_EXPIRE_TIME, S336_FU_OWN_TYPE, S337_FU_OWN_ID, S338_FREE_UNIT_TYPE, S339_FREE_UNIT_ID, S340_BONUS_AMOUNT, S341_CURRENT_AMOUNT, S342_FU_MEASURE_ID, S343_OPER_TYPE, S344_CUR_EXPIRE_TIME, S345_FU_OWN_TYPE, S346_FU_OWN_ID, S347_FREE_UNIT_TYPE, S348_FREE_UNIT_ID, S349_BONUS_AMOUNT, S350_CURRENT_AMOUNT, S351_FU_MEASURE_ID, S352_OPER_TYPE, S353_CUR_EXPIRE_TIME, S354_FU_OWN_TYPE, S355_FU_OWN_ID, S356_FREE_UNIT_TYPE, S357_FREE_UNIT_ID, S358_BONUS_AMOUNT, S359_CURRENT_AMOUNT, S360_FU_MEASURE_ID, S361_OPER_TYPE, S362_CUR_EXPIRE_TIME, S363_FU_OWN_TYPE, S364_FU_OWN_ID, S365_FREE_UNIT_TYPE, S366_FREE_UNIT_ID, S367_BONUS_AMOUNT, S368_CURRENT_AMOUNT, S369_FU_MEASURE_ID, S370_OPER_TYPE, S371_CUR_EXPIRE_TIME, S372_CALLINGPARTYNUMBER, S373_CALLEDPARTYNUMBER, S374_CALLINGPARTYIMSI, S375_CALLEDPARTYIMSI, S376_DIALEDNUMBER, S377_ORIGINALCALLEDPARTY, S378_SERVICEFLOW, S379_CALLFORWARDINDICATOR, S380_CALLINGROAMINFO, S381_CALLINGCELLID, S382_CALLEDROAMINFO, S383_CALLEDCELLID, S384_TIMESTAMPOFSSP, S385_TIMEZONEOFSSP, S386_BEARERCAPABILITY, 
S387_CHARGINGTIME, S388_SENDRESULT, S389_SMSID, S390_IMEI, S391_SMLENGTH, S392_SMSCADDRESS, S393_REFUNDINDICATOR, S394_BRANDID, S395_MAINOFFERINGID, S396_CHARGINGPARTYNUMBER, S397_CHARGEPARTYINDICATOR, S398_PAYTYPE, S399_CHARGINGTYPE, S400_SMSTYPE, S401_ONNETINDICATOR, S402_ROAMSTATE, S403_CALLINGHOMECOUNTRYCODE, S404_CALLINGHOMEAREANUMBER, S405_CALLINGHOMENETWORKCODE, S406_CALLINGROAMCOUNTRYCODE, S407_CALLINGROAMAREANUMBER, S408_CALLINGROAMNETWORKCODE, S409_CALLEDHOMECOUNTRYCODE, S410_CALLEDHOMEAREANUMBER, S411_CALLEDHOMENETWORKCODE, S412_CALLEDROAMCOUNTRYCODE, S413_CALLEDROAMAREANUMBER, S414_CALLEDROAMNETWORKCODE, S415_SERVICETYPE, S416_SPECIALNUMBERINDICATOR, S417_NPFLAG, S418_NPPREFIX, S419_CALLINGCUGNO, S420_CALLEDCUGNO, S421_OPPOSENETWORKTYPE, S422_OPPOSENUMBERTYPE, S423_CALLINGNETWORKTYPE, S424_CALLEDNETWORKTYPE, S425_CALLINGVPNTOPGROUPNUMBER, S426_CALLINGVPNGROUPNUMBER, S427_CALLINGVPNSHORTNUMBER, S428_CALLEDVPNTOPGROUPNUMBER, S429_CALLEDVPNGROUPNUMBER, S430_CALLEDVPNSHORTNUMBER, S431_GROUPCALLTYPE, S432_ONLINECHARGINGFLAG, 
S433_STARTTIMEOFBILLCYCLE, S434_LASTEFFECTOFFERING, S435_DTDISCOUNT, S436_OPPOSEMAINOFFERINGID, S437_HOMEZONEID, S438_SPECIALZONEID, S439_MAINBALANCEINFO, S440_CHGBALANCEINFO, S441_CHGFREEUNITINFO, S442_USERSTATE, S443_GROUPPAYFLAG, S444_ROAMINGZONEID, S445_PRIMARYOFFERCHGAMT, S446_RESERVED, S447_RECEPIENT_CP_ID, S448_TAXINFO, S449_VISTLOCALSTARTTIME, S450_VISTLOCALENDTIME, S451_SUBSCRIBER_KEY, S452_ACCOUNT_KEY, S453_OWNER_CUST_CODE, S454_SAMEBRANDFLAG, S455_TADIGCODE, S456_DISCOUNTOFLASTEFFOFFERING, S457_UNROUND, S458_TAPFILENAME, S459_PREPAID_BALANCE, S460_POSTPAID_BALANCE, S461_PAY_PAYTYPE, S462_PAY_BILL_CYCLE_ID, S463_PAY_FREE_UNIT_TIMES, S464_PAY_DEBIT_AMOUNT, S465_PAY_DEBIT_FROM_PREPAID, S466_PAY_PREPAID_BALANCE, S467_PAY_ACCOUNT_KEY, S468_PAY_DEBIT_FROM_POSTPAID, S469_PAY_POSTPAID_BALANCE, S470_PAY_DEFAULT_ACCT_ID, S471_PAY_CUST_ID, S472_PAY_CUST_CODE, S473_ENTIREAMOUNT, S474_ACCUMULATIONCHANGE, S475_ACCTBALCHGLIST, S476_CHARGE_OF_FUND_AMOUNT, S477_PAY_CHARGE_OF_FUND_AMOUNT, S478_PAY_SUB_ID, S479_RATED_OFFER_ID, S480_OVERDRAFTFLAG)
(SELECT TO_DATE(TO_CHAR(SYSDATE, 'MM/DD/YYYY'), 'MM/DD/YYYY'), FILE_NAME,S1_CDR_ID, S2_CDR_SUB_ID, S3_CDR_TYPE, S4_SPLIT_CDR_REASON, S5_CDR_BATCH_ID, S6_SRC_REC_LINE_NO, S7_SRC_CDR_ID, S8_SRC_CDR_NO, S9_STATUS, S10_RE_RATING_TIMES, S11_CREATE_DATE, S12_START_DATE, S13_END_DATE, S14_CUST_LOCAL_START_DATE, S15_CUST_LOCAL_END_DATE, S16_STD_EVT_TYPE_ID, S17_EVT_SOURCE_CATEGORY, S18_OBJ_TYPE, S19_OBJ_ID, S20_OWNER_CUST_ID, S21_DEFAULT_ACCT_ID, S22_PRI_IDENTITY, S23_BILL_CYCLE_ID, S24_SERVICE_CATEGORY, S25_USAGE_SERVICE_TYPE, S26_SESSION_ID, S27_RESULT_CODE, S28_RESULT_REASON, S29_BE_ID, S30_HOT_SEQ, S31_CP_ID, S32_RECIPIENT_NUMBER, S33_USAGE_MEASURE_ID, S34_ACTUAL_USAGE, S35_RATE_USAGE, S36_SERVICE_UNIT_TYPE, S37_USAGE_MEASURE_ID2, S38_ACTUAL_USAGE2, S39_RATE_USAGE2, S40_SERVICE_UNIT_TYPE2, S41_DEBIT_AMOUNT, S42_RESERVED, S43_DEBIT_FROM_PREPAID, S44_DEBIT_FROM_ADVANCE_PREPAID, S45_DEBIT_FROM_POSTPAID, S46_DEBIT_FROM_ADVANCE_POST, S47_DEBIT_FROM_CREDIT_POSTPAID, S48_TOTAL_TAX, S49_PAY_FREE_UNIT_TIMES, S50_PAY_FREE_UNIT_DURATION, 
S51_FREE_UNIT_AMOUNT_OF_FLUX, S52_ACCT_ID, S53_ACCT_BALANCE_ID, S54_BALANCE_TYPE, S55_CUR_BALANCE, S56_CHG_BALANCE, S57_CURRENCY_ID, S58_OPER_TYPE, S59_ACCT_ID, S60_ACCT_BALANCE_ID, S61_BALANCE_TYPE, S62_CUR_BALANCE, S63_CHG_BALANCE, S64_CURRENCY_ID, S65_OPER_TYPE, S66_ACCT_ID, S67_ACCT_BALANCE_ID, S68_BALANCE_TYPE, S69_CUR_BALANCE, S70_CHG_BALANCE, S71_CURRENCY_ID, S72_OPER_TYPE, S73_ACCT_ID, S74_ACCT_BALANCE_ID, S75_BALANCE_TYPE, S76_CUR_BALANCE, S77_CHG_BALANCE, S78_CURRENCY_ID, S79_OPER_TYPE, S80_ACCT_ID, S81_ACCT_BALANCE_ID, S82_BALANCE_TYPE, S83_CUR_BALANCE, S84_CHG_BALANCE, S85_CURRENCY_ID, S86_OPER_TYPE, S87_ACCT_ID, S88_ACCT_BALANCE_ID, S89_BALANCE_TYPE, S90_CUR_BALANCE, S91_CHG_BALANCE, S92_CURRENCY_ID, S93_OPER_TYPE, S94_ACCT_ID, S95_ACCT_BALANCE_ID, S96_BALANCE_TYPE, S97_CUR_BALANCE, S98_CHG_BALANCE, S99_CURRENCY_ID, S100_OPER_TYPE, S101_ACCT_ID, S102_ACCT_BALANCE_ID, S103_BALANCE_TYPE, S104_CUR_BALANCE, S105_CHG_BALANCE, S106_CURRENCY_ID, S107_OPER_TYPE, S108_ACCT_ID, S109_ACCT_BALANCE_ID, 
S110_BALANCE_TYPE, S111_CUR_BALANCE, S112_CHG_BALANCE, S113_CURRENCY_ID, S114_OPER_TYPE, S115_ACCT_ID, S116_ACCT_BALANCE_ID, S117_BALANCE_TYPE, S118_CUR_BALANCE, S119_CHG_BALANCE, S120_CURRENCY_ID, S121_OPER_TYPE, S122_FU_OWN_TYPE, S123_FU_OWN_ID, S124_FREE_UNIT_ID, S125_FREE_UNIT_TYPE, S126_CUR_AMOUNT, S127_CHG_AMOUNT, S128_FU_MEASURE_ID, S129_OPER_TYPE, S130_FU_OWN_TYPE, S131_FU_OWN_ID, S132_FREE_UNIT_ID, S133_FREE_UNIT_TYPE, S134_CUR_AMOUNT, S135_CHG_AMOUNT, S136_FU_MEASURE_ID, S137_OPER_TYPE, S138_FU_OWN_TYPE, S139_FU_OWN_ID, S140_FREE_UNIT_ID, S141_FREE_UNIT_TYPE, S142_CUR_AMOUNT, S143_CHG_AMOUNT, S144_FU_MEASURE_ID, S145_OPER_TYPE, S146_FU_OWN_TYPE, S147_FU_OWN_ID, S148_FREE_UNIT_ID, S149_FREE_UNIT_TYPE, S150_CUR_AMOUNT, S151_CHG_AMOUNT, S152_FU_MEASURE_ID, S153_OPER_TYPE, S154_FU_OWN_TYPE, S155_FU_OWN_ID, S156_FREE_UNIT_ID, S157_FREE_UNIT_TYPE, S158_CUR_AMOUNT, S159_CHG_AMOUNT, S160_FU_MEASURE_ID, S161_OPER_TYPE, S162_FU_OWN_TYPE, S163_FU_OWN_ID, S164_FREE_UNIT_ID, S165_FREE_UNIT_TYPE, S166_CUR_AMOUNT, 
S167_CHG_AMOUNT, S168_FU_MEASURE_ID, S169_OPER_TYPE, S170_FU_OWN_TYPE, S171_FU_OWN_ID, S172_FREE_UNIT_ID, S173_FREE_UNIT_TYPE, S174_CUR_AMOUNT, S175_CHG_AMOUNT, S176_FU_MEASURE_ID, S177_OPER_TYPE, S178_FU_OWN_TYPE, S179_FU_OWN_ID, S180_FREE_UNIT_ID, S181_FREE_UNIT_TYPE, S182_CUR_AMOUNT, S183_CHG_AMOUNT, S184_FU_MEASURE_ID, S185_OPER_TYPE, S186_FU_OWN_TYPE, S187_FU_OWN_ID, S188_FREE_UNIT_ID, S189_FREE_UNIT_TYPE, S190_CUR_AMOUNT, S191_CHG_AMOUNT, S192_FU_MEASURE_ID, S193_OPER_TYPE, S194_FU_OWN_TYPE, S195_FU_OWN_ID, S196_FREE_UNIT_ID, S197_FREE_UNIT_TYPE, S198_CUR_AMOUNT, S199_CHG_AMOUNT, S200_FU_MEASURE_ID, S201_OPER_TYPE, S202_ACCT_ID, S203_ACCT_BALANCE_ID, S204_BALANCE_TYPE, S205_BONUS_AMOUNT, S206_CUR_BALANCE, S207_CURRENCY_ID, S208_OPER_TYPE, S209_CUR_EXPIRE_TIME, S210_ACCT_ID, S211_ACCT_BALANCE_ID, S212_BALANCE_TYPE, S213_CUR_BALANCE, S214_CHG_BALANCE, S215_CURRENCY_ID, S216_OPER_TYPE, S217_CUR_EXPIRE_TIME, S218_ACCT_ID, S219_ACCT_BALANCE_ID, S220_BALANCE_TYPE, S221_CUR_BALANCE, S222_CHG_BALANCE, S223_CURRENCY_ID, 
S224_OPER_TYPE, S225_CUR_EXPIRE_TIME, S226_ACCT_ID, S227_ACCT_BALANCE_ID, S228_BALANCE_TYPE, S229_BONUS_AMOUNT, S230_CUR_BALANCE, S231_CURRENCY_ID, S232_OPER_TYPE, S233_CUR_EXPIRE_TIME, S234_ACCT_ID, S235_ACCT_BALANCE_ID, S236_BALANCE_TYPE, S237_BONUS_AMOUNT, S238_CUR_BALANCE, S239_CURRENCY_ID, S240_OPER_TYPE, S241_CUR_EXPIRE_TIME, S242_ACCT_ID, S243_ACCT_BALANCE_ID, S244_BALANCE_TYPE, S245_BONUS_AMOUNT, S246_CUR_BALANCE, S247_CURRENCY_ID, S248_OPER_TYPE, S249_CUR_EXPIRE_TIME, S250_ACCT_ID, S251_ACCT_BALANCE_ID, S252_BALANCE_TYPE, S253_BONUS_AMOUNT, S254_CUR_BALANCE, S255_CURRENCY_ID, S256_OPER_TYPE, S257_CUR_EXPIRE_TIME, S258_ACCT_ID, S259_ACCT_BALANCE_ID, S260_BALANCE_TYPE, S261_BONUS_AMOUNT, S262_CUR_BALANCE, S263_CURRENCY_ID, S264_OPER_TYPE, S265_CUR_EXPIRE_TIME, S266_ACCT_ID, S267_ACCT_BALANCE_ID, S268_BALANCE_TYPE, S269_BONUS_AMOUNT, S270_CUR_BALANCE, S271_CURRENCY_ID, S272_OPER_TYPE, S273_CUR_EXPIRE_TIME, S274_ACCT_ID, S275_ACCT_BALANCE_ID, S276_BALANCE_TYPE, S277_BONUS_AMOUNT, S278_CUR_BALANCE, S279_CURRENCY_ID, 
S280_OPER_TYPE, S281_CUR_EXPIRE_TIME, S282_FU_OWN_TYPE, S283_FU_OWN_ID, S284_FREE_UNIT_TYPE, S285_FREE_UNIT_ID, S286_BONUS_AMOUNT, S287_CURRENT_AMOUNT, S288_FU_MEASURE_ID, S289_OPER_TYPE, S290_CUR_EXPIRE_TIME, S291_FU_OWN_TYPE, S292_FU_OWN_ID, S293_FREE_UNIT_TYPE, S294_FREE_UNIT_ID, S295_BONUS_AMOUNT, S296_CURRENT_AMOUNT, S297_FU_MEASURE_ID, S298_OPER_TYPE, S299_CUR_EXPIRE_TIME, S300_FU_OWN_TYPE, S301_FU_OWN_ID, S302_FREE_UNIT_TYPE, S303_FREE_UNIT_ID, S304_BONUS_AMOUNT, S305_CURRENT_AMOUNT, S306_FU_MEASURE_ID, S307_OPER_TYPE, S308_CUR_EXPIRE_TIME, S309_FU_OWN_TYPE, S310_FU_OWN_ID, S311_FREE_UNIT_TYPE, S312_FREE_UNIT_ID, S313_BONUS_AMOUNT, S314_CURRENT_AMOUNT, S315_FU_MEASURE_ID, S316_OPER_TYPE, S317_CURRENT_AMOUNT, S318_FU_OWN_TYPE, S319_FU_OWN_ID, S320_FREE_UNIT_TYPE, S321_FREE_UNIT_ID, S322_BONUS_AMOUNT, S323_CURRENT_AMOUNT, S324_FU_MEASURE_ID, S325_OPER_TYPE, S326_CUR_EXPIRE_TIME, S327_FU_OWN_TYPE, S328_FU_OWN_ID, S329_FREE_UNIT_TYPE, S330_FREE_UNIT_ID, S331_BONUS_AMOUNT, S332_CURRENT_AMOUNT, S333_FU_MEASURE_ID, S334_OPER_TYPE, 
S335_CUR_EXPIRE_TIME, S336_FU_OWN_TYPE, S337_FU_OWN_ID, S338_FREE_UNIT_TYPE, S339_FREE_UNIT_ID, S340_BONUS_AMOUNT, S341_CURRENT_AMOUNT, S342_FU_MEASURE_ID, S343_OPER_TYPE, S344_CUR_EXPIRE_TIME, S345_FU_OWN_TYPE, S346_FU_OWN_ID, S347_FREE_UNIT_TYPE, S348_FREE_UNIT_ID, S349_BONUS_AMOUNT, S350_CURRENT_AMOUNT, S351_FU_MEASURE_ID, S352_OPER_TYPE, S353_CUR_EXPIRE_TIME, S354_FU_OWN_TYPE, S355_FU_OWN_ID, S356_FREE_UNIT_TYPE, S357_FREE_UNIT_ID, S358_BONUS_AMOUNT, S359_CURRENT_AMOUNT, S360_FU_MEASURE_ID, S361_OPER_TYPE, S362_CUR_EXPIRE_TIME, S363_FU_OWN_TYPE, S364_FU_OWN_ID, S365_FREE_UNIT_TYPE, S366_FREE_UNIT_ID, S367_BONUS_AMOUNT, S368_CURRENT_AMOUNT, S369_FU_MEASURE_ID, S370_OPER_TYPE, S371_CUR_EXPIRE_TIME, S372_CALLINGPARTYNUMBER, S373_CALLEDPARTYNUMBER, S374_CALLINGPARTYIMSI, S375_CALLEDPARTYIMSI, S376_DIALEDNUMBER, S377_ORIGINALCALLEDPARTY, S378_SERVICEFLOW, S379_CALLFORWARDINDICATOR, S380_CALLINGROAMINFO, S381_CALLINGCELLID, S382_CALLEDROAMINFO, S383_CALLEDCELLID, S384_TIMESTAMPOFSSP, S385_TIMEZONEOFSSP, S386_BEARERCAPABILITY, 
S387_CHARGINGTIME, S388_SENDRESULT, S389_SMSID, S390_IMEI, S391_SMLENGTH, S392_SMSCADDRESS, S393_REFUNDINDICATOR, S394_BRANDID, S395_MAINOFFERINGID, S396_CHARGINGPARTYNUMBER, S397_CHARGEPARTYINDICATOR, S398_PAYTYPE, S399_CHARGINGTYPE, S400_SMSTYPE, S401_ONNETINDICATOR, S402_ROAMSTATE, S403_CALLINGHOMECOUNTRYCODE, S404_CALLINGHOMEAREANUMBER, S405_CALLINGHOMENETWORKCODE, S406_CALLINGROAMCOUNTRYCODE, S407_CALLINGROAMAREANUMBER, S408_CALLINGROAMNETWORKCODE, S409_CALLEDHOMECOUNTRYCODE, S410_CALLEDHOMEAREANUMBER, S411_CALLEDHOMENETWORKCODE, S412_CALLEDROAMCOUNTRYCODE, S413_CALLEDROAMAREANUMBER, S414_CALLEDROAMNETWORKCODE, S415_SERVICETYPE, S416_SPECIALNUMBERINDICATOR, S417_NPFLAG, S418_NPPREFIX, S419_CALLINGCUGNO, S420_CALLEDCUGNO, S421_OPPOSENETWORKTYPE, S422_OPPOSENUMBERTYPE, S423_CALLINGNETWORKTYPE, S424_CALLEDNETWORKTYPE, S425_CALLINGVPNTOPGROUPNUMBER, S426_CALLINGVPNGROUPNUMBER, S427_CALLINGVPNSHORTNUMBER, S428_CALLEDVPNTOPGROUPNUMBER, S429_CALLEDVPNGROUPNUMBER, S430_CALLEDVPNSHORTNUMBER, S431_GROUPCALLTYPE, S432_ONLINECHARGINGFLAG, 
S433_STARTTIMEOFBILLCYCLE, S434_LASTEFFECTOFFERING, S435_DTDISCOUNT, S436_OPPOSEMAINOFFERINGID, S437_HOMEZONEID, S438_SPECIALZONEID, S439_MAINBALANCEINFO, S440_CHGBALANCEINFO, S441_CHGFREEUNITINFO, S442_USERSTATE, S443_GROUPPAYFLAG, S444_ROAMINGZONEID, S445_PRIMARYOFFERCHGAMT, S446_RESERVED, S447_RECEPIENT_CP_ID, S448_TAXINFO, S449_VISTLOCALSTARTTIME, S450_VISTLOCALENDTIME, S451_SUBSCRIBER_KEY, S452_ACCOUNT_KEY, S453_OWNER_CUST_CODE, S454_SAMEBRANDFLAG, S455_TADIGCODE, S456_DISCOUNTOFLASTEFFOFFERING, S457_UNROUND, S458_TAPFILENAME, S459_PREPAID_BALANCE, S460_POSTPAID_BALANCE, S461_PAY_PAYTYPE, S462_PAY_BILL_CYCLE_ID, S463_PAY_FREE_UNIT_TIMES, S464_PAY_DEBIT_AMOUNT, S465_PAY_DEBIT_FROM_PREPAID, S466_PAY_PREPAID_BALANCE, S467_PAY_ACCOUNT_KEY, S468_PAY_DEBIT_FROM_POSTPAID, S469_PAY_POSTPAID_BALANCE, S470_PAY_DEFAULT_ACCT_ID, S471_PAY_CUST_ID, S472_PAY_CUST_CODE, S473_ENTIREAMOUNT, S474_ACCUMULATIONCHANGE, S475_ACCTBALCHGLIST, S476_CHARGE_OF_FUND_AMOUNT, S477_PAY_CHARGE_OF_FUND_AMOUNT, S478_PAY_SUB_ID, S479_RATED_OFFER_ID, S480_OVERDRAFTFLAG FROM SMS01_EXT)
/
COMMIT
/
UPDATE cdr_head_merge
   SET process_status=96
 WHERE source='sms'
   AND file_name='$1'
/
COMMIT
/
EXIT
EOF
}

# ======= SMSC SECTION =====

lock=/data02/scripts/process/bin/l1_sms_temp_loader_lock  export lock

if [ -f $lock ] ; then
exit 2

else
touch $lock

fileList=`get_smsc_files`

for fil in $fileList
do

v3=`echo ${fil}|sed s/,/\ /g|awk '{print $3}'`   ### file name
v4=`echo ${fil}|sed s/,/\ /g|awk '{print $4}'`   ### file id

cd /data02/scripts/process/bin/loading_l1/temp_etl
sh esms_create_cbs01_ext_sms.sh $v3 
createSMSCUpdate $v3
insertSMSCUpdate $v3


# ~~~~~~~~~~~~~~~~~~~~~~~~
updateOnError $v3 $v4
#~~~~~~~~~~~~~~~~~~~~~~~~~

done

rm -f $lock

fi

